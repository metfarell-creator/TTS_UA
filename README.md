# StyleTTS 2 Ukrainian EXP

Оновлені інструкції для запуску українського експериментального стенда на базі StyleTTS 2.

## Ключові можливості
- **Gradio UI** з окремими вкладками для **Multi speaker** і **Single speaker**.
- Автоматична або ручна вербалізація тексту (додавання наголосів, заміна чисел тощо).
- Вибір голосу для багатоголосого режиму, контроль швидкості мовлення.
- Підтримка символу `+` для ручного виставлення наголосу.

## Швидкий старт
1. Встановіть залежності з `requirements.txt` (у проєкті використовується PyTorch 2.x, Gradio, PyYAML та бібліотеки Hugging Face).
   Зверніть увагу, що пакет `styletts2-inference` встановлюється безпосередньо з GitHub, тож потрібен доступ до `git`.
2. За потреби налаштуйте `config.yml` — у ньому зберігаються межі швидкості, ліміти довжини тексту та шляхи до локальних директорій.
3. Запустіть `run.bat` (Windows) або `python app.py` — під час першого старту застосунок автоматично завантажить моделі з Hugging Face:
   - `patriotyk/styletts2_ukrainian_multispeaker_hifigan`,
   - `patriotyk/styletts2_ukrainian_single`,
   - `skypro1111/mbart-large-50-verbalization`.
   Файли кешуються у папці `models/`, повторні запуски відпрацьовують офлайн.
4. Розмістіть локальні стилі голосів (`*.pt`) у папці `voices/` та файл стилю для single-режиму (`filatov.pt`) у корені проєкту (шляхи задаються в `config.yml`).
5. Відкрийте адресу, вказану Gradio, у браузері та синтезуйте мовлення.

## Системні вимоги
- **Python 3.11** (перевірено на Windows із вбудованим `python-portable`).
- **PyTorch 2.x** з підтримкою CUDA (якщо використовуєте GPU).
- Додаткові бібліотеки: `gradio`, `ukrainian-word-stress`, `ipa-uk`, `transformers`, `styletts2_inference`, `huggingface_hub` та інші із `requirements.txt`.

## Особливості реалізації
- Вербалізатор працює повністю офлайн та автоматично підбирає токенайзер (спершу `AutoTokenizer`, потім fallback на `MBart50TokenizerFast`).
- Для кожного голосу використовується `.pt` файл зі стилем; при відсутності вибраного голосу в multi-режимі береться перший доступний.
- Аудіофрагменти об'єднуються через `torch.cat`, а після синтезу повертається сигнал з частотою 24 кГц.
- Усі обчислення виконуються в режимі `torch.inference_mode()`; параметри можна гнучко налаштувати у `config.yml`.

## Конфігурація
`config.yml` постачається з готовими значеннями за замовчуванням і може бути змінений під власні потреби:
- `sample_rate` — частота дискретизації аудіосигналу у Гц.
- `text.max_length` та `text.chunk_length` — обмеження довжини вхідного тексту та розміру шматків для обробки.
- `speed` — межі, крок та значення за замовчуванням для повзунка швидкості.
- `paths` — шляхи до папок із моделями та стилями.
- `huggingface.repos` — відповідність локальних директорій і віддалених репозиторіїв, що завантажуються автоматично.

## Налагодження
- Якщо бачите попередження про токенайзер — переконайтеся, що всі файли моделі в наявності; fallback покриває типові випадки офлайн-роботи.
- Для великих текстів застосовується розбиття на частини з урахуванням довжини та розділових знаків.
- Можна додавати власні стилі у папку `voices/`; файл має бути сумісним із моделлю (отриманим через StyleTTS 2).

## Запуск
- **Windows**: подвійний клік по `run.bat`.
- **Linux/macOS**: активуйте середовище та виконайте `python app.py`.
- Gradio автоматично відкриє API (`api_open=True`) і виведе посилання для браузера.
